% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/add_index.R
\name{add_double_index}
\alias{add_double_index}
\title{Add double index columns to tabulation results}
\usage{
add_double_index(tab)
}
\arguments{
\item{tab}{A tibble or data frame containing tabulation results, typically generated
from \code{\link{create_tabulations}}. Must contain columns named 'Variable', 'Label',
'Value', 'Total', and one or more subgroup columns with numeric values.}
}
\value{
A tibble with the same structure as the input table, plus additional columns
with "_di" suffix containing the calculated double index values for each subgroup.
The double index columns are added alongside the original value columns.
}
\description{
This function calculates double index values for cross-tabulated survey data by applying
the formula: (value - column_average - row_average + grand_average) * 100. The double
index helps identify cells that are significantly higher or lower than expected based
on marginal distributions. Positive values indicate over-representation while negative
values indicate under-representation.
}
\details{
The double index calculation follows these steps:
\enumerate{
\item Calculate the grand mean across all cells for each variable
\item Calculate row means (average across subgroups for each row)
\item Calculate column means (average down each subgroup for each variable)
\item Apply the adjustment formula: (cell_value - column_mean - row_mean + grand_mean) * 100
}

Values are calculated separately for each variable to ensure proper statistical meaning.
Missing values (NA) are excluded from all mean calculations.
}
\examples{
# Using tabulation results from create_tabulations
data(test_list)

# Create cross-tabulations
tabs <- create_tabulations(
  loaded_data = test_list$loaded_data,
  var_labels = test_list$var_labels,
  val_labels = test_list$val_labels,
  col_var = 'scvar_1'
)

# Add double index calculations to proportions table
indexed_props <- add_double_index(tabs$colprops_table)

# View original and indexed results
print(tabs$colprops_table)
print(indexed_props)

# Double index values interpretation:
# Positive values: over-representation in that subgroup
# Negative values: under-representation in that subgroup
# Values near zero: close to expected distribution

}
\seealso{
\code{\link{create_tabulations}} for generating the input tabulation tables
}
